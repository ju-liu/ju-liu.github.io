---
layout: default2
title: CODE
home: passive
cv: passive
research: passice
code: active
description: HPC
---
<div class="cv">

<h2 id="external-library-install-guide">External Library Install Guide</h2>
<p>This is a guide for installing the VTK, PETSc, and related libraries, which are needed by the PERIGEE code. The default operating system is Linux Ubuntu. Installing these libraries on Mac OS may require minor changes in the following steps.</p>
<p>In general, we do an out-of-source compiling, except for PETSc. We will have all the libraries installed in a specified location (in this guide, $HOME/lib). This is because we typically do not have the access to /usr/local in clusters. Essentially, this requires you to specify the install prefix in the configuration stage for each library build.</p>
<p>Some of the libraries are not required for building the code. Typically, we require one to have VTK, PETSc, HDF5, and METIS as minimum requirement.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#Create-a-lib-folder">Create a lib folder</a></li>
<li><a href="#Install-Valgrind">Install Valgrind</a></li>
<li><a href="#Install-CMake">Install CMake</a></li>
<li><a href="#Install-VTK">Install VTK</a></li>
<li><a href="#Install-PETSc">Install PETSc</a></li>
<li><a href="#Install-HDF5">Install HDF5</a></li>
<li><a href="#Install-METIS">Install METIS</a></li>
<li><a href="#Install-Gmsh">Install Gmsh</a></li>
<li><a href="#Install-ParaView">Install ParaView</a></li>
</ul>
<h2 id="create-a-lib-folder">Create a lib folder</h2>
<p>It is recommended to have all the libraries in a single lib folder. Now we create an empty folder in the $HOME director.</p>
<pre><code class="lang-sh">$ cd $HOME
$ mkdir <span class="hljs-class"><span class="hljs-keyword">lib</span></span>
</code></pre>
<h2 id="install-valgrind">Install Valgrind</h2>
<p>The Valgrind is a software for detecting memory leaking errors. It is <strong>not mandatory</strong> for compiling the PERIGEE code. For example, we do not install it on clusters. It is just useful when one do code development. Install Valgrind can be very straightforward in Linux.</p>
<pre><code class="lang-sh">$ sudo apt <span class="hljs-keyword">install</span> valgrind
</code></pre>
<p>Then try</p>
<pre><code class="lang-sh">$ valgrind ls <span class="hljs-_">-l</span>
</code></pre>
<p>to make sure it is working.</p>
<p>Of course, for experienced users, you can download the Valgrind source file and install it in the lib folder. I do not intend to cover that in this guide.</p>
<h2 id="install-cmake">Install CMake</h2>
<p>Make sure you have cmake installed in your system. In case you do not have one, do the following.</p>
<pre><code class="lang-sh">$ sudo apt-<span class="hljs-keyword">get</span> install cmake
</code></pre>
<p>If you are an advanced user and wants to build cmake youself, consult this page: <a href="https://cmake.org/install/">https://cmake.org/install/</a></p>
<p>If you are using a cluster, cmake can be loaded by</p>
<pre><code class="lang-sh">$ <span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">load</span> <span class="hljs-title">cmake</span></span>
</code></pre>
<h2 id="install-vtk">Install VTK</h2>
<p>The PERIGEE code is compatible with VTK-5, VTK-6, and VTK-7. In the following, we demonstrate steps for compiling VTK-7.1.1.</p>
<p>First, download the source file of VTK-7.1.1, and extract the tar ball. You do not have to download it to the lib folder because eventually we will remove the source folder afte we build the library. In this guide, we download it to the home directory.</p>
<pre><code class="lang-sh"><span class="hljs-variable">$ </span>cd <span class="hljs-variable">$HOME</span>
<span class="hljs-variable">$ </span>wget <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/www.vtk.org/files</span><span class="hljs-regexp">/release/</span><span class="hljs-number">7.1</span>/VTK-<span class="hljs-number">7.1</span>.<span class="hljs-number">1</span>.tar.gz
<span class="hljs-variable">$ </span>tar -zxvf VTK-<span class="hljs-number">7.1</span>.<span class="hljs-number">1</span>.tar.gz
</code></pre>
<p>You will have a folder named VTK-7.1.1 now. To avoid confusion, we rename it as VTK-7.1.1-src to indicate this is a source file folder.</p>
<pre><code class="lang-sh">$ mv VTK<span class="hljs-number">-7.1</span><span class="hljs-number">.1</span> VTK<span class="hljs-number">-7.1</span><span class="hljs-number">.1</span>-src
</code></pre>
<p>Second, create an out-of-source build folder, say, in your home directory. This folder will also be removed after building the library. Run the following commands.</p>
<pre><code class="lang-sh"><span class="hljs-variable">$ </span>cd <span class="hljs-variable">$HOME</span>
<span class="hljs-variable">$ </span>mkdir build_vtk
<span class="hljs-variable">$ </span>cd build_vtk
<span class="hljs-variable">$ </span>cmake <span class="hljs-variable">$HOME</span>/VTK-<span class="hljs-number">7.1</span>.<span class="hljs-number">1</span>-src -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$HOME</span>/lib/VTK-<span class="hljs-number">7.1</span>.<span class="hljs-number">1</span>-shared -DBUILD_SHARED_LIBS=ON
<span class="hljs-variable">$ </span>make -j <span class="hljs-number">6</span>
<span class="hljs-variable">$ </span>make install
</code></pre>
<p>A folder named VTK-7.1.1-shared will be created in <code>$HOME/lib</code>. The name of this folder indicate that the library is a shared library, because we set <code>BUILD_SHARED_LIBS=ON</code> in the configuration stage. For an explanation of the differences between shared libraries and static libraries, please consult this <a href="https://stackoverflow.com/questions/2649334/difference-between-static-and-shared-libraries">page</a>. Now, if you go to <code>$HOME/lib/VTK-7.1.1-shared</code>, you should be able to see four sub-directories named as share, include, lib, and bin. Now, you may safely remove VTK-7.1.1.tar.gz, VTK-7.1.1-src, and build_vtk.</p>
<pre><code class="lang-sh">$ rm -rf VTK<span class="hljs-number">-7.1</span><span class="hljs-number">.1</span>.tar.gz VTK<span class="hljs-number">-7.1</span><span class="hljs-number">.1</span>-src build_vtk
</code></pre>
<p>For more detailed discussion of installing the VTK library, refer to the <a href="install-advanced.md">guide for advanced users</a>.</p>
<h2 id="install-petsc">Install PETSc</h2>
<p>First, we enter the lib folder and download petsc source files in the folder.</p>
<pre><code class="lang-sh">$ cd $HOME/<span class="hljs-class"><span class="hljs-keyword">lib</span></span>
$ wget <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/ftp.mcs.anl.gov/pub</span><span class="hljs-regexp">/petsc/release</span>-snapshots/petsc-lite-<span class="hljs-number">3.11</span>.<span class="hljs-number">3</span>.tar.gz
$ tar -zxvf petsc-lite-<span class="hljs-number">3.11</span>.<span class="hljs-number">3</span>.tar.gz
$ ./configure
</code></pre>
<p>Follow the instructions from the configure command output. You may need to download necessary packages by appending argument to the configure command, and these arguments are system-dependent. For most systems, it is safe to do the following.</p>
<pre><code class="lang-sh"><span class="hljs-comment">$</span> <span class="hljs-string">.</span><span class="hljs-comment">/configure</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">download</span><span class="hljs-literal">-</span><span class="hljs-comment">mpich</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">download</span><span class="hljs-literal">-</span><span class="hljs-comment">fblaslapack</span>
</code></pre>
<p>You may have more arguments for the configure command to control your installation. For more information, refer to the <a href="install-advanced.md">advanced user guide</a>.
If the configuration stage is completed successfully, there will be messages to guide you to complete the installation. As an example, on my own machine, I have to do the following steps.</p>
<pre><code class="lang-sh"><span class="hljs-variable">$ </span>make PETSC_DIR=<span class="hljs-regexp">/home/jliu</span><span class="hljs-regexp">/lib/petsc</span>-<span class="hljs-number">3.11</span>.<span class="hljs-number">3</span> PETSC_ARCH=arch-linux2-c-debug all
<span class="hljs-variable">$ </span>make PETSC_DIR=<span class="hljs-regexp">/home/jliu</span><span class="hljs-regexp">/lib/petsc</span>-<span class="hljs-number">3.11</span>.<span class="hljs-number">3</span> PETSC_ARCH=arch-linux2-c-debug check
</code></pre>
<p>On TACC machines, you do not have to install PETSc yourself. Run the following command, you will see the location of the PETSc library on TACC machines.</p>
<pre><code class="lang-sh">$ <span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">load</span> <span class="hljs-title">petsc</span></span>
$ echo $TACC_PETSC_DIR
</code></pre>
<h2 id="install-hdf5">Install HDF5</h2>
<p>Run the following commands to install HDF5.</p>
<pre><code class="lang-sh">$ wget https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.8/hdf5-1.8.16/src/hdf5-1.8.16.tar.gz
$ tar -zxvf hdf5-1.8.16.tar.gz 
$ mv hdf5-1.8.16 hdf5-1.8.16-src
$ cd hdf5-1.8.16-src
$ ./configure --prefix=$HOME/lib/hdf5-1.8.16 --enable-cxx
$ make
$ make<span class="hljs-built_in"> check
</span>$ make install
$ make<span class="hljs-built_in"> check-install
</span>$ cd ..
$ rm -rf hdf5-1.8.16-src
</code></pre>
<p>In the lib folder, there should be a sub-directory hdf5-1.8.16, containing the HDF5 library. Again, on TACC machines, the HDF5 library is already installed. To locate it, run the following.</p>
<pre><code class="lang-sh">$ <span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">load</span> <span class="hljs-title">hdf5</span></span>
$ echo $TACC_HDF5_DIR
</code></pre>
<h2 id="install-metis">Install METIS</h2>
<p>Run the following commands to install METIS</p>
<pre><code class="lang-sh">$ wget <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/glaros.dtc.umn.edu/gkhome</span><span class="hljs-regexp">/fetch/sw</span><span class="hljs-regexp">/metis/</span>OLD/metis-<span class="hljs-number">5.0</span>.<span class="hljs-number">3</span>.tar.gz
$ tar -zxvf metis-<span class="hljs-number">5.0</span>.<span class="hljs-number">3</span>.tar.gz
$ mv metis-<span class="hljs-number">5.0</span>.<span class="hljs-number">3</span> metis-<span class="hljs-number">5.0</span>.<span class="hljs-number">3</span>-src
$ cd metis-<span class="hljs-number">5.0</span>.<span class="hljs-number">3</span>-src
$ make config prefix=$HOME/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">metis</span>-5.0.3</span>
$ make
$ make install
$ cd ..
$ rm -rf metis-<span class="hljs-number">5.0</span>.<span class="hljs-number">3</span>-src
</code></pre>
<h2 id="install-gmsh">Install Gmsh</h2>
<p>The PERIGEE code does <strong>not</strong> depend on Gmsh. However, we frequently use Gmsh to generate input files for unstructured grid. Therefore, it is recommended that you install Gmsh on your machine. This step is <strong>unnecessary</strong> for compiling PERIGEE on clusters. Currently, the code is compatible with the mesh format from Gmsh-3. Run the following commands to install Gmsh. We do not need to link the PERIGEE code to Gmsh. For many cases, we generate a mesh using Gmsh as a binary executable.</p>
<pre><code class="lang-sh"><span class="hljs-symbol">$</span> wget http:<span class="hljs-comment">//gmsh.info/src/gmsh-3.0.6-source.tgz</span>
<span class="hljs-symbol">$</span> tar -zxvf gmsh<span class="hljs-number">-3.0</span><span class="hljs-number">.6</span>-source.tgz
<span class="hljs-symbol">$</span> cd gmsh<span class="hljs-number">-3.0</span><span class="hljs-number">.6</span>-source
<span class="hljs-symbol">$</span> mkdir build
<span class="hljs-symbol">$</span> cd build
<span class="hljs-symbol">$</span> cmake .. -DCMAKE_INSTALL_PREFIX=<span class="hljs-symbol">$</span>HOME/lib/gmsh<span class="hljs-number">-3.0</span><span class="hljs-number">.6</span>
<span class="hljs-symbol">$</span> make
<span class="hljs-symbol">$</span> make install
<span class="hljs-symbol">$</span> cd ../..
<span class="hljs-symbol">$</span> rm -rf gmsh<span class="hljs-number">-3.0</span><span class="hljs-number">.6</span>-source
</code></pre>
<h2 id="install-paraview">Install ParaView</h2>
<p>If you really want to try, you may download the ParaView source file and do an out-of-source build, just like what we did for VTK. I just directly download the binary file from the <a href="https://www.paraview.org/download/">ParaView website</a>, and extract it in the <code>$HOME/lib</code> folder. Note, you do <strong>not</strong> have to install ParaView on a cluster.</p>


</div>
